{"version":3,"sources":["/source/petsHandler.server.js","/source/app.js","/source/petsController.client.js","/source/userController.client.js"],"names":["PetsHandler","this","getPets","req","res","postPet","angular","module","directive","restrict","templateUrl","priority","terminal","link","scope","element","attr","msg","confirmationNeeded","clickAction","ngClick","bind","$","html","modal","unbind","on","$eval","showWait","waitCalls","fadeIn","hideWait","fadeOut","controller","$http","$timeout","$rootScope","$window","$controller","renewMyBooks","loggedIn","get","then","myBooks","data","sort","a","b","borrowUserId","borrowApproved","approvNeedCount","filter","length","renewBooksIWant","wantBooks","renewAllBooks","allBooks","recalcContainerPos","css","masonry","itemSelector","columnWidth","w","width","targetW","Math","floor","userController","tab","showLoader","findedBooks","newNameChanged","newName","deleteBook","book","_id","borrowBook","post","loginClick","returnBook","approveBook","refuseBook","$watch","newValue","oldValue","clearSearch","clickFinded","item","splice","indexOf","id","window","resize","Pet","require","exports","user","loginLink","provider","location"],"mappings":"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","file":"main.min.js","sourcesContent":["'use strict';\n\nvar Pet = require('../models/pet.js');\n\n\nfunction PetsHandler () {\n\t\n\t\n\t\n\t\n\tthis.getPets = function (req, res) {\n\t\n\n\t\t\n\t};\n\t\n\t\n\t\n\tthis.postPet = function(req, res) {\n\t\t/*\n\t\tvar PetId = req.body.id.replace('/','').replace('?','');\n\n\t\t\tvar options = {\n\t\t\t\t  hostname: 'www.googleapis.com',\n\t\t\t\t  port: 443,\n\t\t\t\t  path: '/Pets/v1/volumes/'+PetId+'?fields=volumeInfo/title,volumeInfo/imageLinks/thumbnail,volumeInfo/authors&key='+apiKey,\n\t\t\t\t  method: 'GET'\n\t\t\t\t};\n\t\t\t\tvar reqs = https.request(options, function(r) {\n\t\t\t\t\n\t\t\t\t  var data = '';\n\t\t\t\t\t\n\t\t\t\t  r.on('data', function(d) {\n\t\t\t\t    data+= d;\n\t\t\t\t  });\n\t\t\t\t  \n\t\t\t\t  r.on('end', function() {\n\t\t\t\t    \n\t\t\t\t    data = JSON.parse(data);\n\t\t\t\t   \n\t\t\t\t   var Pet = new Pet();\n\t\t\t\t   \n\t\t\t\t   Pet.title  = data.volumeInfo.title;\n\t\t\t\t   Pet.userId  = req.user.id;\n\t\t\t\t   if(data.volumeInfo.authors){\n\t\t\t\t\t Pet.author = data.volumeInfo.authors.join(',');\n\t\t\t\t   } \n\t\t\t\t   if (data.volumeInfo.imageLinks) {\n\t\t\t\t\t Pet.imgUrl = data.volumeInfo.imageLinks.thumbnail.replace('http://', 'https://');\n\t\t\t\t   }\n\t\t\t\t   \n\t\t\t\t   Pet.save();\n\n\t\t\t\t   res.end();\n\t\t\n\t\t\t\t    \n\t\t\t\t  });\n\t\t\t\t  \n\t\t\t\t});\n\t\t\t\t\n\t\t\t\treqs.end();\n\t\t\t\t\n\t\t\t\treqs.on('error', function(e) {\n\t\t\t\t  throw e;\n\t\t\t\t});\t*/\n\t\t\t\t\n\t\t}\n\t\n\t/*\n\t\n\tthis.borrowPet = function(req, res){\n\t\tPet.findOne({'_id':req.params.id}).\n\t\t  exec(function(err, Pet){\n\t\t  \tif(err)\t{\n\t\t \t\tres.end(err)\n\t\t  \t} else {\n\t\t  \t\tif(Pet.borrowUserId){\n\t\t  \t\t\tres.end('Pet already borrowed.');\n\t\t  \t\t}\n\t\t  \t\t\n\t\t\t\tPet.borrowUserId = req.user.id;\n\t\t\t\tPet.borrowUserName = req.user.displayName;\n\t\t\t\tPet.borrowApproved = false;\n\t\t\t\tPet.save();\n\t\t\t\tres.end();\n\t\t\t}\n\t\t  });\n\t}\n\t\n\tthis.returnPet = function(req, res){\n\t\tPet.findOne({'_id':req.params.id}).\n\t\t  exec(function(err, Pet){\n\t\t  \tif(err)\t{\n\t\t \t\tres.end(err)\n\t\t  \t} else {\n\t\t  \t\tif(Pet.borrowUserId != req.user.id){\n\t\t  \t\t\tres.end('You not borrowed this Pet.');\n\t\t  \t\t} else {\n\t\t  \t\t\n\t\t\t\t\tPet.borrowUserId = null;\n\t\t\t\t\tPet.borrowUserName = null;\n\t\t\t\t\tPet.borrowApproved = false;\n\t\t\t\t\tPet.save();\n\t\t\t\t\tres.end();\n\t\t  \t\t}\n\t\t\t}\n\t\t  });\n\t}\n\t\n\tthis.refusePet = function(req, res){\n\t\tPet.findOne({'_id':req.params.id}).\n\t\t  exec(function(err, Pet){\n\t\t  \tif(err)\t{\n\t\t \t\tres.end(err)\n\t\t  \t} else {\n\t\t  \t\tif(Pet.userId != req.user.id){\n\t\t  \t\t\tres.end('Access denied.');\n\t\t  \t\t} else {\n\t\t  \t\t\n\t\t\t\t\tPet.borrowUserId = null;\n\t\t\t\t\tPet.borrowUserName = null;\n\t\t\t\t\tPet.borrowApproved = false;\n\t\t\t\t\tPet.save();\n\t\t\t\t\tres.end();\n\t\t  \t\t}\n\t\t\t}\n\t\t  });\n\t}\n\t\n\t\n\tthis.approvePet = function(req, res){\n\t\tPet.findOne({'_id':req.params.id}).\n\t\t  exec(function(err, Pet){\n\t\t  \tif(err)\t{\n\t\t \t\tres.end(err)\n\t\t  \t} else {\n\t\t  \t\tif(Pet.userId != req.user.id){\n\t\t  \t\t\tres.end('Access denied.');\n\t\t  \t\t} else {\n\t\t\t\t\tPet.borrowApproved = true;\n\t\t\t\t\tPet.save();\n\t\t\t\t\tres.end();\n\t\t  \t\t}\n\t\t\t}\n\t\t  });\n\t}\n\t\n\t\n\t\n\t\n\t\n\tthis.deletePet = function(req, res) {\n\t\t\n\t\t\n\t\tPet.findOne({'_id':req.params.id, 'userId':req.user.id}).\n\t\t\t\t  exec(function(err, Pet){\n\t\t\t\t  \tif(err)\t{\n\t\t\t\t  \t\tres.end(err)\n\t\t\t\t  \t} else {\n\t\t\t  \t\t\tPet.remove();\n\t\t\t  \t\t\tres.end();\n\t\t\t\t  \t}\n\t\t\t\t  });\n\t\t\n\t\t\n\t}\n\t\n\t*/\n\n}\n\nmodule.exports = PetsHandler;\n","\n\n\nangular.module('megabyte.funny-pets', [])\n\n\n.directive('appTitle', function() {\n  return {\n    restrict: 'E',\n    templateUrl: 'partials/app-title.html'\n  };\n})\n\n.directive('confirmationNeeded', function () {\n  return {\n    priority: 1,\n    terminal: true,\n    link: function (scope, element, attr) {\n        \n      var msg = attr.confirmationNeeded || \"Are you sure?\";\n      \n      var clickAction = attr.ngClick;\n      element.bind('click', function(){\n           $('#modal-confirm-text').html(msg);\n           $('#confirmation-modal').modal();\n           $('#modal-confirm-btn').unbind('click');\n           $('#modal-confirm-btn').on('click', function() {\n              $('#confirmation-modal').modal('hide'); \n              scope.$eval(clickAction);\n          }); \n      });\n    }\n  };\n});\n\n","'use strict';\n\n\n\n\n(function() {\n\n    var waitCalls = 0;\n\n    function showWait() {\n        waitCalls++;\n        if (waitCalls === 1) {\n            $('.loader-frame').fadeIn();\n        }\n    }\n\n    function hideWait() {\n        waitCalls--;\n        if (waitCalls === 0) {\n            $('.loader-frame').fadeOut();\n        }\n    }\n\n\n    angular.module('megabyte.funny-pets')\n\n    .controller('BooksController', function($http, $timeout, $rootScope, $window, $controller) {\n\n\n        var userController = $controller('UserController');\n\n\n        var controller = this;\n        controller.tab = 'all';\n        controller.showLoader = 0;\n        \n        controller.findedBooks = [];\n        \n        controller.wantBooks = [];\n        controller.myBooks = [];\n        controller.allBooks = [];\n\n\n\n        controller.newNameChanged = function() {\n\n\n            if (controller.newName && (controller.newName.length > 2)) {\n\n                showWait();\n                $http.get('/api/book?newBookName=' + controller.newName).then(function(res) {\n\n                    hideWait();\n                    if (res.data && res.data.length) {\n                        controller.findedBooks = res.data;\n                    }\n\n                }, hideWait);\n            }\n            else {\n                controller.findedBooks = [];\n            }\n\n        }\n\n        controller.deleteBook = function(book) {\n            showWait();\n            $http.delete('/api/book/'+book._id).then(function(res) {\n                renewMyBooks();\n                hideWait();\n\n            }, hideWait);\n        }\n        \n        controller.borrowBook = function(book) {\n            if($rootScope.loggedIn) {\n                showWait();\n                $http.post('/api/book/'+book._id).then(function(res) {\n                    renewAllBooks();\n                    renewBooksIWant();\n                    hideWait();\n                }, hideWait);\n            } else {\n                userController.loginClick();\n            }\n        }\n        \n        controller.returnBook = function(book) {\n           showWait();\n           $http.get('/api/book/return/'+book._id).then(function(res) {\n              renewAllBooks();\n              renewBooksIWant();\n              hideWait();\n           }, hideWait);\n        }\n        \n        controller.approveBook = function(book) {\n           showWait();\n           $http.get('/api/book/approve/'+book._id).then(function(res) {\n              renewMyBooks();\n              hideWait();\n           }, hideWait);\n        }\n        \n        controller.refuseBook = function(book) {\n           showWait();\n           $http.get('/api/book/refuse/'+book._id).then(function(res) {\n              renewMyBooks();\n              hideWait();\n           }, hideWait);\n        }\n        \n        \n        \n        \n\n\n        function renewMyBooks() {\n            if($rootScope.loggedIn) {\n                showWait();\n                $http.get('/api/book?myBooks=1').then(function(res) {\n                    hideWait();\n                    controller.myBooks = res.data;\n                    controller.myBooks.sort(function(a,b){\n                       if(a.borrowUserId){\n                           if(!b.borrowUserId){\n                                return -1;\n                           } else {\n                               \n                               if(a.borrowApproved && !b.borrowApproved) {\n                                   return 1;\n                               } else if (!a.borrowApproved && b.borrowApproved) {\n                                   return -1;\n                               }\n                               \n                               \n                           }\n                       } else {\n                           if(b.borrowUserId){\n                               return 1;\n                           }\n                       }\n                       return 0;\n                    });\n                    \n                    controller.approvNeedCount = controller.myBooks.filter(function(b) {\n                        return b.borrowUserId && !b.borrowApproved;\n                    }).length;\n                    \n                    \n                }, hideWait);\n            }\n        }\n        \n        function renewBooksIWant() {\n            if($rootScope.loggedIn) {        \n                showWait();\n                $http.get('/api/book?booksIWant=1').then(function(res) {\n                    hideWait();\n                    controller.wantBooks = res.data;\n                }, hideWait);\n                \n            }\n        }\n        \n        $rootScope.$watch('[loggedIn]', function (newValue, oldValue) {\n           if(newValue){\n              renewMyBooks();\n              renewBooksIWant();\n           } else {\n               controller.myBooks = [];\n           }\n        }, true);\n        \n        function renewAllBooks() {\n            showWait();\n            $http.get('/api/book').then(function(res) {\n                hideWait();\n                controller.allBooks = res.data;\n            }, hideWait);\n        }\n        renewAllBooks();\n        \n        \n        \n        \n        controller.clearSearch = function(){\n            controller.findedBooks = [];\n            controller.newName ='';\n        }\n        \n        controller.clickFinded = function(item) {\n            controller.findedBooks.splice(controller.findedBooks.indexOf(item), 1);\n            \n            showWait();\n            $http.post('/api/book', {\n                'id': item.id\n            }).then(function(res) {\n                renewMyBooks();\n                hideWait();\n            }, hideWait);\n        }\n        \n        \n       \n        \n        function recalcContainerPos(){\n            \n             $('.grid').css('width', '');\n            \n             $('.grid').masonry({\n              // options\n              itemSelector: '.grid-item',\n              columnWidth: 210\n            });\n        \n            var w = $('.grid').width();\n            \n            var targetW = Math.floor(w/210)*210 + 40;\n            \n           $('.grid').css('width', ''+targetW+'px');\n            \n            \n        }\n        \n        $( window ).resize(recalcContainerPos);\n        recalcContainerPos();\n\n    });\n\n\n})();\n","'use strict';\n\n(function () {\n\n   angular.module('megabyte.funny-pets')\n\n     .controller('UserController', function($http, $rootScope) {\n         \n       var user = this;\n       \n       \n       user.loginLink = '/login';\n       $http.get('/auth/lastLoggedFrom').then(function(res){\n        if(res.data.provider){\n            user.loginLink = '/auth/'+res.data.provider;\n        }\n       });\n\n       \n       $http.get('/api').then(function(res){\n         user.data = res.data;\n         $rootScope.loggedIn = res.data.id;\n       });\n        \n       user.loginClick = function(){\n           window.location = $('#loginlink').attr('href');\n       }\n        \n       $('.link-to-login').on('click', function(){\n          user.loginClick();\n       });\n        \n     });\n\n\n})();\n"],"sourceRoot":"/source/"}